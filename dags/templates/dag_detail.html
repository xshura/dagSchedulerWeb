<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dag Detail</title>
    <!-- ================= Favicon ================== -->
    <!-- Standard -->
    <link rel="shortcut icon" href="http://placehold.it/64.png/000/fff">
    <!-- Retina iPad Touch Icon-->
    <link rel="apple-touch-icon" sizes="144x144" href="http://placehold.it/144.png/000/fff">
    <!-- Retina iPhone Touch Icon-->
    <link rel="apple-touch-icon" sizes="114x114" href="http://placehold.it/114.png/000/fff">
    <!-- Standard iPad Touch Icon-->
    <link rel="apple-touch-icon" sizes="72x72" href="http://placehold.it/72.png/000/fff">
    <!-- Standard iPhone Touch Icon-->
    <link rel="apple-touch-icon" sizes="57x57" href="http://placehold.it/57.png/000/fff">
    <!-- Styles -->
    <link href="../../statics/assets/fontAwesome/css/fontawesome-all.min.css" rel="stylesheet">
    <link href="../../statics/assets/css/lib/themify-icons.css" rel="stylesheet">
    <link href="../../statics/assets/css/lib/mmc-chat.css" rel="stylesheet" />
    <link href="../../statics/assets/css/lib/sidebar.css" rel="stylesheet">
    <link href="../../statics/assets/css/lib/bootstrap.min.css" rel="stylesheet">
    <link href="../../statics/assets/css/lib/nixon.css" rel="stylesheet">
    <link href="../../statics/assets/lib/lobipanel/css/lobipanel.min.css" rel="stylesheet">
    <link href="../../statics/assets/css/style.css" rel="stylesheet">

    <link rel="stylesheet" href="../../statics/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../statics/drawflow/dist/drawflow.min.css">
    <link rel="stylesheet" href="../../statics/drawflow/dist/all.min.css">
    <link rel="stylesheet" type="text/css" href="../../statics/drawflow/dist/beautiful.css" />
    <link rel="stylesheet" type="text/css" href="../../statics/drawflow/dist/swap.css" />
    <script src="../../statics/assets/js/lib/jquery.min.js"></script>
    <script src="../../statics/drawflow/dist/drawflow.min.js"></script>
    <script src="../../statics/drawflow/dist/all.min.js"></script>
    <script src="../../statics/drawflow/dist/sweetalert.min.js"></script>
    <script src="../../statics/drawflow/dist/micromodal.min.js"></script>
</head>

<body>
    <div class="header">
        <div class="pull-left">
            <div class="logo">
                <a href="admin.html">
                    <img id="logoImg" src="../../statics/logo/logo.png" data-logo_big="../../statics/logo/logo.png" data-logo_small="../../statics/logo/logoSmall.png" alt="Nixon">
                </a>
            </div>
            <div class="hamburger sidebar-toggle">
                <span class="ti-menu"></span>
            </div>
        </div>
        <div class="pull-right p-r-15">
            <ul>
                <li class="header-icon dib">
                    <i class="ti-bell"></i>
                    <div class="note-count">2</div>
                    <div class="drop-down">
                        <div class="dropdown-content-heading">
                            <span class="text-left">Recent Notifications</span>
                        </div>
                        <div class="dropdown-content-body">
                            <ul>
                                <li>
                                    <a href="#">
                                        <img class="pull-left m-r-10 avatar-img" src="../../statics/assets/images/avatar/3.jpg" alt="">
                                        <div class="notification-content">
                                            <small class="notification-timestamp pull-right">02:34 PM</small>
                                            <div class="notification-heading">Mr. Jane</div>
                                            <div class="notification-text">5 members joined today </div>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img class="pull-left m-r-10 avatar-img" src="../../statics/assets/images/avatar/3.jpg" alt="">
                                        <div class="notification-content">
                                            <small class="notification-timestamp pull-right">02:34 PM</small>
                                            <div class="notification-heading">Mariam</div>
                                            <div class="notification-text">likes a photo of you</div>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img class="pull-left m-r-10 avatar-img" src="../../statics/assets/images/avatar/3.jpg" alt="">
                                        <div class="notification-content">
                                            <small class="notification-timestamp pull-right">02:34 PM</small>
                                            <div class="notification-heading">Tasnim</div>
                                            <div class="notification-text">Hi Teddy, Just wanted to let you ...</div>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img class="pull-left m-r-10 avatar-img" src="../../statics/assets/images/avatar/3.jpg" alt="">
                                        <div class="notification-content">
                                            <small class="notification-timestamp pull-right">02:34 PM</small>
                                            <div class="notification-heading">Jane Roe</div>
                                            <div class="notification-text">Hi Teddy, Just wanted to let you ...</div>
                                        </div>
                                    </a>
                                </li>
                                <li class="text-center">
                                    <a href="#" class="more-link">See All</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li class="header-icon dib">
                    <i class="ti-email"></i>
                    <div class="note-count">21</div>
                    <div class="drop-down">
                        <div class="dropdown-content-heading">
                            <span class="text-left">2 New Messages</span>
                            <a href="app-email.html"><i class="ti-pencil-alt pull-right"></i></a>
                        </div>
                        <div class="dropdown-content-body">
                            <ul>
                                <li class="notification-unread">
                                    <a href="#">
                                        <img class="pull-left m-r-10 avatar-img" src="../../statics/assets/images/avatar/1.jpg" alt="">
                                        <div class="notification-content">
                                            <small class="notification-timestamp pull-right">02:34 PM</small>
                                            <div class="notification-heading">Jane Doe</div>
                                            <div class="notification-text">Hi Teddy, Just wanted to let you ...</div>
                                        </div>
                                    </a>
                                </li>
                                <li class="notification-unread">
                                    <a href="#">
                                        <img class="pull-left m-r-10 avatar-img" src="../../statics/assets/images/avatar/2.jpg" alt="">
                                        <div class="notification-content">
                                            <small class="notification-timestamp pull-right">02:34 PM</small>
                                            <div class="notification-heading">Jane Roe</div>
                                            <div class="notification-text">Hi Teddy, Just wanted to let you ...</div>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img class="pull-left m-r-10 avatar-img" src="../../statics/assets/images/avatar/3.jpg" alt="">
                                        <div class="notification-content">
                                            <small class="notification-timestamp pull-right">02:34 PM</small>
                                            <div class="notification-heading">Jane Doe</div>
                                            <div class="notification-text">Hi Teddy, Just wanted to let you ...</div>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img class="pull-left m-r-10 avatar-img" src="../../statics/assets/images/avatar/2.jpg" alt="">
                                        <div class="notification-content">
                                            <small class="notification-timestamp pull-right">02:34 PM</small>
                                            <div class="notification-heading">Jane Roe</div>
                                            <div class="notification-text">Hi Teddy, Just wanted to let you ...</div>
                                        </div>
                                    </a>
                                </li>
                                <li class="text-center">
                                    <a href="#" class="more-link">See All</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li class="header-icon dib chat-sidebar-icon"><i class="ti-comments"></i></li>
                <li class="header-icon dib">
                    <img class="avatar-img" src="../../statics/assets/images/avatar/1.jpg" alt=""> <span class="user-avatar">Jane <i class="ti-angle-down f-s-10"></i></span>
                    <div class="drop-down dropdown-profile">
                        <div class="dropdown-content-heading">
                            <span class="text-left">Upgrade Now</span>
                            <p class="trial-day">30 Days Trail</p>
                        </div>
                        <div class="dropdown-content-body">
                            <ul>
                                <li><a href="#"><i class="ti-user"></i> <span>Profile</span></a></li>
                                <li><a href="#"><i class="ti-wallet"></i> <span>My Balance</span></a></li>
                                <li><a href="#"><i class="ti-write"></i> <span>My Task</span></a></li>
                                <li><a href="#"><i class="ti-calendar"></i> <span>My Calender</span></a></li>
                                <li><a href="#"><i class="ti-email"></i> <span>Inbox</span></a></li>
                                <li><a href="#"><i class="ti-settings"></i> <span>Setting</span></a></li>
                                <li><a href="#"><i class="ti-help-alt"></i> <span>Help</span></a></li>
                                <li><a href="#"><i class="ti-lock"></i> <span>Lock Screen</span></a></li>
                                <li><a href="#"><i class="ti-power-off"></i> <span>Logout</span></a></li>
                            </ul>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <!-- END chat Sidebar-->
    <div class="content-wrap">
        <div class="main">
            <div class="wrapper">
                <div class="col-right">
                    <div id="drawflow" ondrop="drop(event)" ondragover="allowDrop(event)" style="width: 2050px; height: 1500px;">
                    <div class="btn-lock">
                      <i id="lock" class="fas fa-lock" onclick="editor.editor_mode='fixed'; changeMode('lock');"></i>
                      <i id="unlock" class="fas fa-lock-open" onclick="editor.editor_mode='edit'; changeMode('unlock');" style="display:none;"></i>
                    </div>
                    <div class="bar-zoom">
                      <i class="fas fa-search-minus" onclick="editor.zoom_out()"></i>
                      <i class="fas fa-search" onclick="editor.zoom_reset()"></i>
                      <i class="fas fa-search-plus" onclick="editor.zoom_in()"></i>
                    </div>
                    <div class="drawflow">
<!--                        {% for task in task_list %}-->
<!--                        <div class="parent-node" id="{{task.id}}" hidden="hidden">-->
<!--                              <div class="drawflow-node" style="top: {{task.top}}px; left: {{task.left}}px;">-->
<!--                                  <div class="inputs"><div class="input input_1"></div></div>-->
<!--                                  <div class="drawflow_content_node">-->
<!--                                      <div>-->
<!--                                          <div class="title-box">-->
<!--                                          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">-->
<!--                                          <circle cx="8" cy="8" r="8"/>-->
<!--                                          </svg>    <span>Task Node: {{task.id}}</span></div>-->
<!--                                          <div class="box">-->
<!--                                          <p>Task Describe</p>-->
<!--                                          <input type="text" df="task" value={{task.task}} disabled="disabled">-->
<!--                                          </div>-->
<!--                                          <div class="box">-->
<!--                                          <p>Resource Type</p>-->
<!--                                          <input type="text" df="type" value={{task.resource_type}} disabled="disabled">-->
<!--                                          </div>-->
<!--                                          <div class="box">-->
<!--                                          <p>Occupy Time</p>-->
<!--                                          <input type="text" df="occupy" value={{task.occupy_time}} disabled="disabled">-->
<!--                                          </div>-->
<!--                                      </div>-->
<!--                                  </div>-->
<!--                                  <div class="outputs"><div class="output output_1"></div></div>-->
<!--                              </div>-->
<!--                        </div>-->
<!--                        {% endfor %}-->
<!--                        {% for edge in edges %}-->
<!--    &lt;!&ndash;                    <svg class="connection node_in_node-{{edge.in}} node_out_node-{{edge.out}} output_1 input_1"><path class="main-path" d="M {{edge.s_x}} {{edge.s_y}} C 908 247.5 908 245.5 1012.5  245.5"></path></svg>&ndash;&gt;-->
<!--                        <svg class="connection node_in_node-{{edge.in}} node_out_node-{{edge.out}} output_1 input_1"><path class="main-path" d="M 260 240 C 908 247.5 908 245.5 1012.5  245.5"></path></svg>-->
<!--                        {% endfor %}-->
                    </div>
                  </div>
                </div>
                </div>

            </div>
        </div>
        <!-- /# main -->
        </div>
    </div>
<!-- /# content wrap -->
<!-- jquery vendor -->
<script src="../../statics/assets/js/lib/jquery.nanoscroller.min.js"></script>
<!-- nano scroller -->
<script src="../../statics/assets/js/lib/sidebar.js"></script>
<!-- sidebar -->
<script src="../../statics/assets/js/lib/bootstrap.min.js"></script>
<!-- bootstrap -->
<script src="../../statics/assets/js/lib/mmc-common.js"></script>
<script src="../../statics/assets/js/lib/mmc-chat.js"></script>
<!--  Chart js -->
<script src="../../statics/assets/js/lib/chart-js/Chart.bundle.js"></script>
<script src="../../statics/assets/js/lib/chart-js/chartjs-init.js"></script>
<!-- // Chart js -->
<!--  Datamap -->
<script src="../../statics/assets/js/lib/datamap/d3.min.js"></script>
<script src="../../statics/assets/js/lib/datamap/topojson.js"></script>
<script src="../../statics/assets/js/lib/datamap/datamaps.world.min.js"></script>
<script src="../../statics/assets/js/lib/datamap/datamap-init.js"></script>
<script src="../../statics/assets/lib/lobipanel/js/lobipanel.js"></script>
<!-- // Datamap -->
<script src="../../statics/assets/js/scripts.js"></script>
<!-- scripit init-->
<script>
    $(document).ready(function() {
        $('#lobipanel-custom-control').lobiPanel({
            reload: false,
            close: false,
            editTitle: false
        });
    });


    var id = document.getElementById("drawflow");
    const editor = new Drawflow(id);
    var draw = {"drawflow":
                    {"Home":
                       {"data":{}}
                     }
                };
    {% for task in task_list %}
     var pos_x = {{task.left}};
     var pos_y = {{task.top}};

     var node_{{task.id}} = `
          <div>
          <div class="title-box">
             <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
             <circle cx="8" cy="8" r="8"/>
             </svg>    <span>Task Node: {{task.id}}</span></div>
             <div class="box">
             <p>Task Describe</p>
             <input type="text" df="task" value={{task.task}} disabled="disabled">
             </div>
             <div class="box">
             <p>Resource Type</p>
             <input type="text" df="type" value={{task.resource_type}} disabled="disabled">
             </div>
             <div class="box">
             <p>Occupy Time</p>
             <input type="text" df="occupy" value={{task.occupy_time}} disabled="disabled">
             </div>
          </div>
          `;
     var node = {"id":{{task.id}},
                 "name":"node-{{task.id}}",
                 "data":{},
                 "class":"telegram",
                 "html": node_{{task.id}},
                 "typenode": false,
                 "inputs":{"input_1": {"connections": []}},
                 "outputs":{"output_1": {"connections": []}},
                 "pos_x": pos_x-960,
                 "pos_y":pos_y};

     var inputs = [];
        {% if task.input %}
        {% for x in task.input %}
        inputs.push({"node": "{{x.node_id}}", "input": "output_1"});
        {% endfor %}
        {% endif %}

     var outputs = [];
        {% if task.output %}
        {% for x in task.output %}
        outputs.push({"node": "{{x.node_id}}", "output": "input_1"});
        {% endfor %}
        {% endif %}

     node["inputs"]["input_1"]["connections"] = inputs
     node["outputs"]["output_1"]["connections"] = outputs
     draw["drawflow"]["Home"]["data"]["{{task.id}}"] = node;
     {% endfor %}
    console.log(draw);
    editor.drawflow = draw
    editor.start();

        // Events!
    editor.on('nodeCreated', function(id) {
      console.log("Node created " + id);
    })

    editor.on('nodeRemoved', function(id) {
      console.log("Node removed " + id);
    })

    editor.on('nodeSelected', function(id) {
      console.log("Node selected " + id);
    })

    editor.on('moduleCreated', function(name) {
      console.log("Module Created " + name);
    })

    editor.on('moduleChanged', function(name) {
      console.log("Module Changed " + name);
    })

    editor.on('connectionCreated', function(connection) {
      console.log('Connection created');
      console.log(connection);
    })

    editor.on('connectionRemoved', function(connection) {
      console.log('Connection removed');
      console.log(connection);
    })

    editor.on('mouseMove', function(position) {
      console.log('Position mouse x:' + position.x + ' y:'+ position.y);
    })

    editor.on('zoom', function(zoom) {
      console.log('Zoom level ' + zoom);
    })

    editor.on('translate', function(position) {
      console.log('Translate x:' + position.x + ' y:'+ position.y);
    })

    /* DRAG EVENT */

    /* Mouse and Touch Actions */

    var elements = document.getElementsByClassName('drag-drawflow');
    for (var i = 0; i < elements.length; i++) {
      elements[i].addEventListener('touchend', drop, false);
      elements[i].addEventListener('touchmove', positionMobile, false);
      elements[i].addEventListener('touchstart', drag, false );
    }

    var mobile_item_selec = '';
    var mobile_last_move = null;
   function positionMobile(ev) {
     mobile_last_move = event;
   }

   function allowDrop(ev) {
      ev.preventDefault();
    }

    function drag(ev) {
      if (ev.type === "touchstart") {
        mobile_item_selec = ev.target.closest(".drag-drawflow").getAttribute('data-node');
      } else {
        ev.dataTransfer.setData("node", ev.target.getAttribute('data-node'));
      }
    }

    function drop(ev) {
      if (ev.type === "touchend") {
        var parentdrawflow = document.elementFromPoint( mobile_last_move.touches[0].clientX, mobile_last_move.touches[0].clientY).closest("#drawflow");
        if(parentdrawflow != null) {
          addNodeToDrawFlow(mobile_item_selec, mobile_last_move.touches[0].clientX, mobile_last_move.touches[0].clientY);
        }
        mobile_item_selec = '';
      } else {
        ev.preventDefault();
        var data = ev.dataTransfer.getData("node");
        addNodeToDrawFlow(data, ev.clientX, ev.clientY);
      }

    }
      var transform = '';
  function showpopup(e) {
    e.target.closest(".drawflow-node").style.zIndex = "9999";
    e.target.children[0].style.display = "block";
    //document.getElementById("modalfix").style.display = "block";

    //e.target.children[0].style.transform = 'translate('+translate.x+'px, '+translate.y+'px)';
    transform = editor.precanvas.style.transform;
    editor.precanvas.style.transform = '';
    editor.precanvas.style.left = editor.canvas_x +'px';
    editor.precanvas.style.top = editor.canvas_y +'px';
    console.log(transform);

    //e.target.children[0].style.top  =  -editor.canvas_y - editor.container.offsetTop +'px';
    //e.target.children[0].style.left  =  -editor.canvas_x  - editor.container.offsetLeft +'px';
    editor.editor_mode = "fixed";

  }

   function closemodal(e) {
     e.target.closest(".drawflow-node").style.zIndex = "2";
     e.target.parentElement.parentElement.style.display  ="none";
     //document.getElementById("modalfix").style.display = "none";
     editor.precanvas.style.transform = transform;
       editor.precanvas.style.left = '0px';
       editor.precanvas.style.top = '0px';
      editor.editor_mode = "edit";
   }

    function changeModule(event) {
      var all = document.querySelectorAll(".menu ul li");
        for (var i = 0; i < all.length; i++) {
          all[i].classList.remove('selected');
        }
      event.target.classList.add('selected');
    }

    function changeMode(option) {

    //console.log(lock.id);
      if(option == 'lock') {
        lock.style.display = 'none';
        unlock.style.display = 'block';
      } else {
        lock.style.display = 'block';
        unlock.style.display = 'none';
      }

    }

</script>
<!--            var obj = JSON.stringify(editor.export(), null,4);-->
</body>

</html>